language: php

dist: trusty

sudo: false

services:
    - docker

addons:
    apt:
        packages:
            - docker-ce

cache:
    directories:
        - $HOME/.composer/cache/files

branches:
    only:
        - master

matrix:
    fast_finish: true
    include:
        - php: '7.2'
          env: TARGET=test
        - php: '7.2'
          env: TARGET=check

before_install:
    - sudo service postgresql stop
    # wait for postgresql to shutdown
    - while sudo lsof -Pi :5432 -sTCP:LISTEN -t; do sleep 1; done

install:
    - make install

script: make $TARGET
